<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<div class="container">
    <div class="row">
    <div class="mb-3" id="signin">
        <label for="email" class="form-label">Email address</label>
        <input type="email" class="form-control" id="email" placeholder="name@example.com">
        <button type="button" class="btn btn-primary" onclick="signIn()">Sign In</button>
    </div>
        <div class="mb-3" id="text">
            <label for="textIn" class="form-label">Example textarea</label>
            <textarea class="form-control" id="textIn" rows="3"></textarea>
            <button type="button" class="btn btn-primary" onclick="generateText()">Generate Text</button>
        </div>
    </div>
</div>
<div id="ret">
</div>
<script>
    $("#text").hide();
    let cookieValue = document.cookie
        .split('; ')
        .find(row => row.startsWith('token='));
    if (typeof cookieValue !== "undefined"){
        cookieValue = cookieValue.split('=')[1];
        $("#signin").hide();
        $("#text").show();
    }


    function signIn() {
        const myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");

        const raw = JSON.stringify({"email":"tmanyik@gmail.com"});

        const requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
        };

        fetch("https://justification.herokuapp.com/api/signin", requestOptions)
            .then(response => response.text())
            .then(result => {
                document.cookie = "token="+result;
                $("#text").show();
                $("#signin").hide();
            })
            .catch(error => console.log('error', error));
    }

    function generateText(){
        const text = document.getElementById("textIn").value;
        const myHeaders = new Headers();
        myHeaders.append("Authorization", "Bearer "+cookieValue);
        myHeaders.append("Content-Type", "application/json");

        const raw = JSON.stringify({"text":text});

        const requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
        };

        fetch("https://justification.herokuapp.com/api/getText", requestOptions)
            .then(response => response.text())
            .then(result => {
                document.getElementById("ret").innerHTML = result;
                console.log(result)
            })
            .catch(error => console.log('error', error));
    }
</script>
